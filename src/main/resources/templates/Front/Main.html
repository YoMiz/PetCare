<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/style.css}" />

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
</head>

<body>
	<div id="sidebar-menu">
		<button id="openbtn-pet" class="openbtn" onclick="openNav('pet')"> <img src="/images/icon/paw.png" alt=""
				width="30px" height="30px" />ペットメニュー　</button>
		<div id="sidebar-pet" class="sidebar">
			<button class="closebtn" onclick="closeNav('pet')">X</button>
			<img src="/images/icon/paw.png" alt="" width="30px" height="30px" />
			<h4>ペットメニュー</h4>
		</div>

		<button id="openbtn-inventory" class="openbtn" onclick="openNav('inventory')">
			<img src="/images/icon/bone.png" alt="" width="30px" height="30px" />在庫メニュー　</button>
		<div id="sidebar-inventory" class="sidebar">
			<button class="closebtn" onclick="closeNav('inventory')">X</button>
			<img src="/images/icon/bone.png" alt="" width="30px" height="30px" />
			<h4>在庫メニュー</h4>
		</div>

		<button id="openbtn-contact" class="openbtn" onclick="openNav('contact')">
			<img src="/images/icon/tel.png" alt="" width="30px" height="30px" />連絡メニュー　</button>
		<div id="sidebar-contact" class="sidebar">
			<button class="closebtn" onclick="closeNav('contact')">X</button>
			<img src="/images/icon/tel.png" alt="" width="30px" height="30px" />
			<h4>連絡先メニュー</h4>
		</div>
	</div>
	<main>
		<div id="petCarousel" class="carousel slide">
			<div class="carousel-inner">
				<div th:each="petData, stat : ${petList}" class="carousel-item"
					th:classappend="${stat.first} ? 'active' : ''">
					<img th:src="@{'/images/' + ${petData.petPhoto}}" class="d-block d-block-image" alt="Pet Photo"
						th:attr="data-petid=${petData.petId}">

					<div class="carousel-caption d-none d-md-block">
						<h5 th:text="${petData.petName}"></h5>
						<p>Age: <span th:text="${petData.petAge}"></span></p>
						<p>Birthday: <span th:text="${#dates.format(petData.petBirthday,'yyyy/MM/dd')}"></span></p>
						<p>Status: <span th:text="${petData.statusName}"></span></p>
					</div>
				</div>
				<!-- ここにペットのグラフを挿入 -->
			</div>

			<!-- 前後のアイテムに切り替えるためのボタン -->
			<button class="carousel-control-prev" type="button" data-bs-target="#petCarousel" data-bs-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
			</button>
			<button class="carousel-control-next" type="button" data-bs-target="#petCarousel" data-bs-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
			</button>
		</div>
		<br />
		<div class="pet-scroll">
			<div th:each="petData, stat : ${petList}">
				<img th:src="@{'/images/' + ${petData.petPhoto}}" class="${petData.petId}"
					th:attr="data-petid=${petData.petId}" width="150px" height="150px">
			</div>
		</div>

		<br />
		<!-- ペットのアイテム・コンタクトデータ表示エリア -->
		<div th:each="petData : ${petList}" class="inventory-list list" th:id="'inventory-list-' + ${petData.petId}">
			<h2 th:text="${petData.petName}+'　アイテムリスト'" class="contents-header"></h2>
			<br />
			<table>
				<thead>
					<tr>
						<th>内容</th>
						<th>商品名</th>
						<th>在庫数</th>
						<th>製品価格</th>
						<th></th>
					</tr>
				</thead>
				<tbody th:each="inventory : ${petInventoryMap[petData.petId]}">
					<tr>
						<td th:text="${inventory.inventoryTypeName}"></td>
						<td th:text="${inventory.inventoryName}"></td>
						<td th:text="${inventory.inventoryAmount} + '　個'"></td>
						<td th:text="${inventory.inventoryPrice} + '　円'"></td>
						<td>変更</td>
					</tr>
				</tbody>
				<td>追加</td>
			</table>
			<br />
		</div>
		<br />
		<br />
		<div th:each="petData:${petList}" class="contact-list list" th:id="'contact-list-' + ${petData.petId}">
			<h2 th:text="${petData.petName} + '　連絡先リスト'" class="contents-header"></h2>
			<br />
			<table>
				<thead>
					<tr>
						<th>ジャンル</th>
						<th>連絡先</th>
						<th>担当</th>
						<th>電話番号</th>
						<th>メールアドレス</th>
						<th>URL</th>
						<th></th>
					</tr>
				</thead>
				<tbody th:each="contact : ${petContactMap[petData.petId]}">
					<tr>
						<td th:text="${contact.contactTypeName}"></td>
						<td th:text="${contact.contactName}"></td>
						<td th:text="${contact.contactInCharge}"></td>
						<td th:text="${contact.contactTel}"></td>
						<td th:text="${contact.contactMail}"></td>
						<td th:text="${contact.contactUrl}"></td>
						<td>変更</td>
					</tr>
				</tbody>
				<td>追加</td>
			</table>
			<br />
		</div>
		<br />
	</main>
	<script>
		// サイドバーを表示する関数
		function openNav(menuType) {
			document.getElementById('sidebar-' + menuType).style.left = "0";
		}

		// サイドバーを非表示にする関数
		function closeNav(menuType) {
			document.getElementById('sidebar-' + menuType).style.left = "-250px";
		}
	</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		window.onload = function () {
			const petCarousel = document.getElementById('petCarousel');
			const carousel = new bootstrap.Carousel(petCarousel, {
				interval: false,
				ride: false
			});

			const carouselItems = petCarousel.querySelectorAll('.carousel-item');
			const petImages = document.querySelectorAll('.pet-scroll img');

			function logImageId(imageElement) {
				const petId = imageElement.getAttribute('data-petid');
				console.log('Pet ID:', petId);

				// Show the corresponding pet data in the Carousel
				$('.carousel-item.active').removeClass('active');
				$('.carousel-item').each(function () {
					if ($(this).find('img').data('petid') == petId) {
						$(this).addClass('active');
					}
				});

				// Show the corresponding pet data in the list
				$('.inventory-list').hide();
				$('#inventory-list-' + petId).show();
				$('.contact-list').hide();
				$('#contact-list-' + petId).show();
			}

			petImages.forEach(function (imageElement) {
				imageElement.addEventListener('click', function () {
					logImageId(imageElement);
				});
			});

			const carouselPrevButton = document.querySelector('.carousel-control-prev');
			const carouselNextButton = document.querySelector('.carousel-control-next');

			carouselPrevButton.addEventListener('click', function () {
				$(petCarousel).on('slid.bs.carousel', function () {
					const activeImage = petCarousel.querySelector('.carousel-item.active img');
					logImageId(activeImage);
					$(petCarousel).off('slid.bs.carousel');
				});
			});

			carouselNextButton.addEventListener('click', function () {
				$(petCarousel).on('slid.bs.carousel', function () {
					const activeImage = petCarousel.querySelector('.carousel-item.active img');
					logImageId(activeImage);
					$(petCarousel).off('slid.bs.carousel');
				});
			});
		};
	</script>
</body>

</html>